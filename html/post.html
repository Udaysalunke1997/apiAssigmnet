<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Post Manager with Image Upload</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <svg width="0" height="0" class="hidden">
        <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512" id="chevron-right-solid">
            <path
                d="M310.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-192 192c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L242.7 256 73.4 86.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l192 192z">
            </path>
        </symbol>
        <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512" id="chevron-left-solid">
            <path
                d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l192 192c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256 246.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-192 192z">
            </path>
        </symbol>
        <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" id="plus-solid">
            <path
                d="M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 144L48 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l144 0 0 144c0 17.7 14.3 32 32 32s32-14.3 32-32l0-144 144 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-144 0 0-144z">
            </path>
        </symbol>
        <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" id="trash-solid">
            <path
                d="M135.2 17.7L128 32 32 32C14.3 32 0 46.3 0 64S14.3 96 32 96l384 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-96 0-7.2-14.3C307.4 6.8 296.3 0 284.2 0L163.8 0c-12.1 0-23.2 6.8-28.6 17.7zM416 128L32 128 53.2 467c1.6 25.3 22.6 45 47.9 45l245.8 0c25.3 0 46.3-19.7 47.9-45L416 128z">
            </path>
        </symbol>
        <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="table-cells-large-solid">
            <path
                d="M448 96l0 128-160 0 0-128 160 0zm0 192l0 128-160 0 0-128 160 0zM224 224L64 224 64 96l160 0 0 128zM64 288l160 0 0 128L64 416l0-128zM64 32C28.7 32 0 60.7 0 96L0 416c0 35.3 28.7 64 64 64l384 0c35.3 0 64-28.7 64-64l0-320c0-35.3-28.7-64-64-64L64 32z">
            </path>
        </symbol>
        <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="list-solid">
            <path
                d="M40 48C26.7 48 16 58.7 16 72l0 48c0 13.3 10.7 24 24 24l48 0c13.3 0 24-10.7 24-24l0-48c0-13.3-10.7-24-24-24L40 48zM192 64c-17.7 0-32 14.3-32 32s14.3 32 32 32l288 0c17.7 0 32-14.3 32-32s-14.3-32-32-32L192 64zm0 160c-17.7 0-32 14.3-32 32s14.3 32 32 32l288 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-288 0zm0 160c-17.7 0-32 14.3-32 32s14.3 32 32 32l288 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-288 0zM16 232l0 48c0 13.3 10.7 24 24 24l48 0c13.3 0 24-10.7 24-24l0-48c0-13.3-10.7-24-24-24l-48 0c-13.3 0-24 10.7-24 24zM40 368c-13.3 0-24 10.7-24 24l0 48c0 13.3 10.7 24 24 24l48 0c13.3 0 24-10.7 24-24l0-48c0-13.3-10.7-24-24-24l-48 0z">
            </path>
        </symbol>
        <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="pen-solid">
            <path
                d="M362.7 19.3L314.3 67.7 444.3 197.7l48.4-48.4c25-25 25-65.5 0-90.5L453.3 19.3c-25-25-65.5-25-90.5 0zm-71 71L58.6 323.5c-10.4 10.4-18 23.3-22.2 37.4L1 481.2C-1.5 489.7 .8 498.8 7 505s15.3 8.5 23.7 6.1l120.3-35.4c14.1-4.2 27-11.8 37.4-22.2L421.7 220.3 291.7 90.3z">
            </path>
        </symbol>
        <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="right-from-bracket-solid">
            <path
                d="M377.9 105.9L500.7 228.7c7.2 7.2 11.3 17.1 11.3 27.3s-4.1 20.1-11.3 27.3L377.9 406.1c-6.4 6.4-15 9.9-24 9.9c-18.7 0-33.9-15.2-33.9-33.9l0-62.1-128 0c-17.7 0-32-14.3-32-32l0-64c0-17.7 14.3-32 32-32l128 0 0-62.1c0-18.7 15.2-33.9 33.9-33.9c9 0 17.6 3.6 24 9.9zM160 96L96 96c-17.7 0-32 14.3-32 32l0 256c0 17.7 14.3 32 32 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-64 0c-53 0-96-43-96-96L0 128C0 75 43 32 96 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32z">
            </path>
        </symbol>
    </svg>

    <svg class="icon">
        <use xlink:href="#pen-solid"></use>
    </svg>
    <!-- Header -->
    <nav class="navbar navbar-expand-lg navbar-light bg-dark px-4">
        <div class="container-fluid justify-content-between">
            <h1 class="text-white h4 m-0">Blog List</h1>
            <a href="login.html" class="btn btn-outline-light">
                <svg class="icon me-1">
                    <use xlink:href="#right-from-bracket-solid"></use>
                </svg>
                Log out
            </a>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container my-5">
        <div class="row mb-3 align-items-center">
            <div class="col-md-6">
                <input type="text" id="searchInput" class="form-control" placeholder="Search posts..."
                    oninput="filterPosts()" />
            </div>
            <div class="col-md-6 text-md-end mt-3 mt-md-0">
                <button class="btn btn-primary" onclick="showAddModal()">
                    <svg class="icon me-1">
                        <use xlink:href="#plus-solid"></use>
                    </svg>
                    Add Post
                </button>
            </div>
        </div>

        <div class="d-flex justify-content-end gap-2 mb-4">
            <button class="btn btn-outline-secondary" onclick="changeView('grid')">
                <svg class="icon">
                    <use xlink:href="#table-cells-large-solid"></use>
                </svg>
            </button>
            <button class="btn btn-outline-secondary" onclick="changeView('list')">
                <svg class="icon">
                    <use xlink:href="#list-solid"></use>
                </svg>
            </button>
        </div>

        <!-- Post List -->
        <div id="postList" class="row">
            <!-- Posts will be injected here dynamically -->
        </div>

        <!-- Pagination -->
        <nav class="mt-4 d-flex justify-content-center">
            <ul class="pagination">
                <li class="page-item"><button class="page-link" onclick="changePage(-1)">Previous</button></li>
                <li class="page-item disabled"><span class="page-link" id="pageNumber">1</span></li>
                <li class="page-item"><button class="page-link" onclick="changePage(1)">Next</button></li>
            </ul>
        </nav>
    </div>

    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <h3 id="modalTitle">Add Post</h3>
            <input type="text" id="titleInput" placeholder="Title" />
            <textarea id="bodyInput" rows="4" placeholder="Body"></textarea>
            <input type="file" id="imageInput" accept="image/*" />
            <button onclick="savePost()">Save</button>
            <button onclick="closeModal()">Cancel</button>
        </div>
    </div>

    <!-- Confirm Delete -->
    <div class="confirm" id="confirmBox">
        <div class="confirm-content">
            <p>Are you sure you want to delete this post?</p>
            <button onclick="confirmDelete()">Yes, Delete</button>
            <button onclick="closeConfirm()">Cancel</button>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:5000';

        let posts = [];
        let filteredPosts = [];
        let currentPage = 1;
        const postsPerPage = 5;
        let isEditing = false;
        let currentPostId = null;

        const postList = document.getElementById('postList');
        const titleInput = document.getElementById('titleInput');
        const bodyInput = document.getElementById('bodyInput');
        const imageInput = document.getElementById('imageInput');
        const searchInput = document.getElementById('searchInput');

        const modal = document.getElementById('modal');
        const confirmBox = document.getElementById('confirmBox');

        async function loadPosts() {
            const res = await fetch(`${API_URL}/posts`);
            posts = await res.json();
            filteredPosts = [...posts];
            renderPosts();
        }

        function renderPosts() {
            postList.innerHTML = '';
            document.getElementById('pageNumber').textContent = currentPage;

            const start = (currentPage - 1) * postsPerPage;
            const pagePosts = filteredPosts.slice(start, start + postsPerPage);

            pagePosts.forEach(post => {
                postList.innerHTML += `
                <div class="col-4 post mb-4">
                    <div class="card shadow-sm">
                        <div class="image">
                        ${post.image ? `<img class="bd-placeholder-img card-img-top" src="${API_URL}${post.image}" alt="Post Image" />` : ''}
                        </div>
                        <div class="card-body">
                            <h5 class="card-title">${truncateText(post.title, 35)}</h5>
                            <p class="card-text">${truncateText(post.body, 100)}</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="btn-group">
                                    <button type="button" class="btn-hover" onclick="editPost(${post.id})">
                                        <svg class="icon">
                                            <use xlink:href="#pen-solid"></use>
                                        </svg>
                                    </button>
                                    <button type="button" class="btn-hover" onclick="showDeleteConfirm(${post.id})">
                                        <svg class="icon">
                                            <use xlink:href="#trash-solid"></use>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                `;
            });
        }

        function changePage(step) {
            const totalPages = Math.ceil(filteredPosts.length / postsPerPage);
            if ((currentPage + step >= 1) && (currentPage + step <= totalPages)) {
                currentPage += step;
                renderPosts();
            }
        }

        function filterPosts() {
            const query = searchInput.value.toLowerCase();
            filteredPosts = posts.filter(p =>
                p.title.toLowerCase().includes(query) || p.body.toLowerCase().includes(query)
            );
            currentPage = 1;
            renderPosts();
        }

        function showAddModal() {
            isEditing = false;
            titleInput.value = '';
            bodyInput.value = '';
            imageInput.value = '';
            document.getElementById('modalTitle').textContent = 'Add Post';
            modal.style.display = 'flex';
        }

        function editPost(id) {
            const post = posts.find(p => p.id === id);
            if (post) {
                isEditing = true;
                currentPostId = id;
                titleInput.value = post.title;
                bodyInput.value = post.body;
                imageInput.value = '';
                document.getElementById('modalTitle').textContent = 'Edit Post';
                modal.style.display = 'flex';
            }
        }

        async function savePost() {
            const title = titleInput.value.trim();
            const body = bodyInput.value.trim();
            const image = imageInput.files[0];

            if (!title || !body) {
                alert('Title and body are required!');
                return;
            }

            const formData = new FormData();
            formData.append('title', title);
            formData.append('body', body);
            if (image) {
                formData.append('image', image);
            }

            if (isEditing) {
                const res = await fetch(`${API_URL}/posts/${currentPostId}`, {
                    method: 'PUT',
                    body: formData
                });
                const updatedPost = await res.json();
                const idx = posts.findIndex(p => p.id === currentPostId);
                posts[idx] = updatedPost;
            } else {
                const res = await fetch(`${API_URL}/posts`, {
                    method: 'POST',
                    body: formData
                });
                const newPost = await res.json();
                posts.unshift(newPost);
            }

            filteredPosts = [...posts];
            closeModal();
            renderPosts();
        }

        function showDeleteConfirm(id) {
            currentPostId = id;
            confirmBox.style.display = 'flex';
        }

        async function confirmDelete() {
            await fetch(`${API_URL}/posts/${currentPostId}`, {
                method: 'DELETE'
            });
            posts = posts.filter(p => p.id !== currentPostId);
            filteredPosts = [...posts];
            renderPosts();
            closeConfirm();
        }

        function closeModal() {
            modal.style.display = 'none';
        }

        function closeConfirm() {
            confirmBox.style.display = 'none';
        }
        function truncateText(text, maxLength) {
            if (!text) return '';
            return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
        }


        loadPosts();
    </script>
</body>

</html>